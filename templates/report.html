<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sales & Profit Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* CSS ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f6f9;
        }

        .sidebar {
            width: 250px;
            min-height: 100vh;
            background-color: #343a40;
            color: white;
            position: fixed;
        }

        .sidebar a {
            color: #c2c7d0;
            text-decoration: none;
            padding: 12px 20px;
            display: block;
            border-bottom: 1px solid #4b545c;
        }

        .sidebar a:hover {
            background-color: #007bff;
            color: white;
        }

        .content {
            margin-left: 250px;
            padding: 30px;
        }

        .card-stat {
            border-left: 4px solid;
        }

        .print-header {
            display: none;
        }

        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏±‡∏ß‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ */

        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏¥‡∏°‡∏û‡πå (Print) */
        @media print {

            /* 1. ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ */
            .sidebar,
            .no-print,
            .btn,
            form {
                display: none !important;
            }

            /* 2. ‡∏à‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© */
            .content {
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
            }

            body {
                background-color: white !important;
                -webkit-print-color-adjust: exact;
            }

            /* 3. ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
            .card {
                border: 1px solid #ddd !important;
                box-shadow: none !important;
                break-inside: avoid;
            }

            table {
                width: 100% !important;
                border-collapse: collapse;
            }

            th,
            td {
                border: 1px solid #ddd !important;
                padding: 8px !important;
            }

            tr {
                page-break-inside: avoid;
            }

            /* ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡πÅ‡∏ñ‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤ */

            /* 4. ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏±‡∏ß‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô */
            .print-header {
                display: block !important;
                margin-bottom: 20px;
                text-align: center;
            }

            .d-print-flex {
                display: flex !important;
            }

            /* ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô */

            /* 5. ‡∏ã‡πà‡∏≠‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå URL ‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏Å‡πÇ‡∏ú‡∏•‡πà‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Chrome/Safari) */
            @page {
                margin: 1cm;
                size: A4;
            }
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <div class="p-3 text-center border-bottom border-secondary">
            <h4 class="mb-0">üì¶ Inventory</h4>
        </div>
        <nav class="mt-2">
            <a href="{{ url_for('main.index') }}"><i class="fas fa-arrow-left me-2"></i> Back to Dashboard</a>
            <a href="{{ url_for('main.report') }}" class="active text-white" style="background-color: #007bff;">
                <i class="fas fa-chart-line me-2"></i> Sales Report
            </a>
        </nav>
    </div>

    <div class="content">

        <div class="print-header">
            <h3>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡πÑ‡∏£ (Sales & Profit Report)</h3>
            <p><strong>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:</strong>
                {% if period == 'today' %}‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ({{ report_data[0].timestamp.strftime('%d/%m/%Y') if report_data else
                'Today' }})
                {% elif period == 'month' %}‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ({{ report_data[0].timestamp.strftime('%B %Y') if report_data else
                'This Month' }})
                {% else %}‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (All Time){% endif %}
            </p>
            <p class="small text-muted">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠: <span id="printDate"></span></p>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4 no-print">
            <h2 class="mb-0"><i class="fas fa-chart-line text-primary"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡πÑ‡∏£</h2>
            <button onclick="window.print()" class="btn btn-secondary shadow-sm">
                <i class="fas fa-print me-2"></i> Print Report
            </button>
        </div>

        <form class="row g-3 mb-4 bg-white p-3 rounded shadow-sm no-print" method="GET">
            <div class="col-auto d-flex align-items-center">
                <label class="me-2 fw-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:</label>
                <select name="period" class="form-select" onchange="this.form.submit()">
                    <option value="today" {% if period=='today' %}selected{% endif %}>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (Today)</option>
                    <option value="month" {% if period=='month' %}selected{% endif %}>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (This Month)</option>
                    <option value="all" {% if period=='all' %}selected{% endif %}>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (All Time)</option>
                </select>
            </div>
        </form>

        <div class="row g-3 mb-4">
            <div class="col-md-4 col-4">
                <div class="card shadow-sm card-stat border-primary h-100">
                    <div class="card-body">
                        <h6 class="text-primary text-uppercase">Total Sales</h6>
                        <h3 class="fw-bold">{{ "{:,.2f}".format(total_sales) }} ‡∏ø</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-4">
                <div class="card shadow-sm card-stat border-danger h-100">
                    <div class="card-body">
                        <h6 class="text-danger text-uppercase">Total Cost</h6>
                        <h3 class="fw-bold">{{ "{:,.2f}".format(total_cost) }} ‡∏ø</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-4">
                <div class="card shadow-sm card-stat border-success h-100">
                    <div class="card-body">
                        <h6 class="text-success text-uppercase">Net Profit</h6>
                        <h3 class="fw-bold">{{ "{:,.2f}".format(total_profit) }} ‡∏ø</h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-0">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0 text-secondary">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (Transaction Details)</h5>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover mb-0 align-middle table-striped">
                    <thead class="table-light">
                        <tr>
                            <th>Date</th>
                            <th>Product</th>
                            <th class="text-center">Qty</th>
                            <th class="text-end">Cost</th>
                            <th class="text-end">Price</th>
                            <th class="text-end">Total Sales</th>
                            <th class="text-end fw-bold text-success">Profit</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in report_data %}
                        <tr>
                            <td>{{ item.timestamp.strftime('%d/%m/%y %H:%M') }}</td>
                            <td>
                                <strong>{{ item.product_name }}</strong>
                                <div class="small text-muted">{{ item.sku }}</div>
                            </td>
                            <td class="text-center">{{ item.quantity }}</td>
                            <td class="text-end text-muted">{{ "{:,.2f}".format(item.cost) }}</td>
                            <td class="text-end text-muted">{{ "{:,.2f}".format(item.price) }}</td>
                            <td class="text-end fw-bold">{{ "{:,.2f}".format(item.total_sales) }}</td>
                            <td class="text-end fw-bold text-success">+{{ "{:,.2f}".format(item.profit) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="table-light fw-bold">
                        <tr>
                            <td colspan="5" class="text-end">Grand Total:</td>
                            <td class="text-end">{{ "{:,.2f}".format(total_sales) }}</td>
                            <td class="text-end text-success">{{ "{:,.2f}".format(total_profit) }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div class="row mt-5 pt-5 text-center d-none d-print-flex">
            <div class="col-6">
                <p>__________________________</p>
                <p>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>
            </div>
            <div class="col-6">
                <p>__________________________</p>
                <p>‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('printDate').innerText = new Date().toLocaleString('th-TH');
    </script>

</body>

</html>