<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document #{{ t.id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: #525659;
            font-family: 'Sarabun', sans-serif;
        }

        .invoice-box {
            max-width: 210mm;
            margin: 30px auto;
            padding: 40px;
            border: 1px solid #eee;
            background: white;
            min-height: 29.7cm;
        }

        .table-invoice th {
            background-color: #f8f9fa;
        }

        /* à¸‹à¹ˆà¸­à¸™à¸›à¸¸à¹ˆà¸¡à¹€à¸§à¸¥à¸²à¸ªà¸±à¹ˆà¸‡à¸›à¸£à¸´à¹‰à¸™à¸—à¹Œ */
        @media print {
            .no-print {
                display: none !important;
            }

            body {
                background: white;
                margin: 0;
            }

            .invoice-box {
                margin: 0;
                padding: 0;
                border: 0;
                width: 100%;
            }
        }

        /* à¸„à¸¥à¸²à¸ªà¸ªà¸³à¸«à¸£à¸±à¸šà¸‹à¹ˆà¸­à¸™à¸£à¸²à¸„à¸² */
        .hide-price {
            display: none !important;
        }
    </style>
</head>

<body>

    <div class="text-center mt-3 mb-3 no-print gap-2 d-flex justify-content-center">
        <button onclick="setMode('invoice')" class="btn btn-primary btn-lg shadow">
            ðŸ“„ Print Invoice<br><small>(à¹‚à¸Šà¸§à¹Œà¸£à¸²à¸„à¸²)</small>
        </button>
        <button onclick="setMode('delivery')" class="btn btn-warning btn-lg shadow text-dark">
            ðŸšš Print Delivery Note<br><small>(à¸‹à¹ˆà¸­à¸™à¸£à¸²à¸„à¸²)</small>
        </button>
        <a href="{{ url_for('transactions.history') }}" class="btn btn-secondary btn-lg shadow">
            ðŸ”™ Back
        </a>
    </div>

    <div class="invoice-box">
        <div class="row mb-4">
            <div class="col-8">
                <h2 class="fw-bold text-primary">ðŸ“¦ ItShutter Inventory</h2>
                <p class="mb-0">123 Tech Street, Bangkok, Thailand</p>
                <p>Tel: 02-123-4567</p>
            </div>
            <div class="col-4 text-end">
                <h3 class="fw-bold text-secondary" id="doc-title">INVOICE</h3>
                <h5 class="text-muted">#DOC-{{ '%04d' % t.id }}</h5>
                <p class="mb-0">Date: {{ t.timestamp.strftime('%d/%m/%Y') }}</p>
            </div>
        </div>

        <hr>

        <div class="row mb-4">
            <div class="col-6">
                <h5 class="fw-bold bg-light p-2 border rounded">Customer:</h5>
                {% if customer %}
                <p class="mb-0 fw-bold">{{ customer.name }}</p>
                <p class="mb-0">{{ customer.address or '-' }}</p>
                <p>Tel: {{ customer.phone or '-' }}</p>
                {% else %}
                <p class="fw-bold">{{ t.party_name }}</p>
                <p class="text-muted">(Walk-in)</p>
                {% endif %}
            </div>
        </div>

        <table class="table table-bordered table-invoice mt-4 align-middle">
            <thead class="text-center">
                <tr>
                    <th style="width: 5%">#</th>
                    <th style="width: 15%">SKU</th>
                    <th style="width: 40%">Description</th>
                    <th style="width: 10%">Qty</th>
                    <th style="width: 15%" class="price-col">Unit Price</th>
                    <th style="width: 15%" class="price-col">Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="text-center">1</td>
                    <td class="text-center">{{ t.sku }}</td>
                    <td>
                        <strong>{{ t.product_name }}</strong>
                        <br><small class="text-muted">{{ product.category if product else '-' }}</small>
                    </td>
                    <td class="text-center fs-5 fw-bold">{{ t.quantity }}</td>

                    {% if product %}
                    <td class="text-end price-col">{{ "{:,.2f}".format(product.selling_price) }}</td>
                    <td class="text-end fw-bold price-col">{{ "{:,.2f}".format(product.selling_price * t.quantity) }}
                    </td>
                    {% else %}
                    <td class="text-end price-col">-</td>
                    <td class="text-end price-col">-</td>
                    {% endif %}
                </tr>
            </tbody>
            <tfoot class="table-light price-col">
                <tr>
                    <td colspan="4" class="text-end fw-bold">Grand Total (Baht):</td>
                    <td colspan="2" class="text-end fs-4 fw-bold text-primary">
                        {% if product %}
                        {{ "{:,.2f}".format(product.selling_price * t.quantity) }}
                        {% else %}
                        0.00
                        {% endif %}
                    </td>
                </tr>
            </tfoot>
        </table>

        <div class="row mt-5 pt-5 text-center">
            <div class="col-6">
                <hr style="width: 80%; margin: auto; border-top: 2px dotted #000;">
                <p class="mt-2">Receiver / Customer</p>
                <small>Date: ____/____/______</small>
            </div>
            <div class="col-6">
                <hr style="width: 80%; margin: auto; border-top: 2px dotted #000;">
                <p class="mt-2">Authorized Signature</p>
                <small>( {{ t.user_name }} )</small>
            </div>
        </div>
    </div>

    <script>
        function setMode(mode) {
            const priceCols = document.querySelectorAll('.price-col');
            const docTitle = document.getElementById('doc-title');

            if (mode === 'invoice') {
                // à¹‚à¸«à¸¡à¸” Invoice: à¹à¸ªà¸”à¸‡à¸£à¸²à¸„à¸², à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸«à¸±à¸§à¹€à¸›à¹‡à¸™ INVOICE
                priceCols.forEach(el => el.classList.remove('hide-price'));
                docTitle.innerText = 'INVOICE';
                document.title = 'Invoice #{{ t.id }}';
            } else {
                // à¹‚à¸«à¸¡à¸” Delivery: à¸‹à¹ˆà¸­à¸™à¸£à¸²à¸„à¸², à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸«à¸±à¸§à¹€à¸›à¹‡à¸™ DELIVERY NOTE
                priceCols.forEach(el => el.classList.add('hide-price'));
                docTitle.innerText = 'DELIVERY NOTE';
                document.title = 'Delivery Note #{{ t.id }}';
            }

            // à¸ªà¸±à¹ˆà¸‡à¸žà¸´à¸¡à¸žà¹Œà¸—à¸±à¸™à¸—à¸µà¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹‚à¸«à¸¡à¸”
            setTimeout(() => {
                window.print();
            }, 300);
        }
    </script>

</body>

</html>